(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{560:function(s,a,e){s.exports=e.p+"assets/img/img.78572476.png"},561:function(s,a,e){s.exports=e.p+"assets/img/img_1.8bd1cf10.png"},655:function(s,a,e){"use strict";e.r(a);var t=e(35),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kubernetes에서-helm-chart로-배포하기"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes에서-helm-chart로-배포하기"}},[s._v("#")]),s._v(" Kubernetes에서 Helm Chart로 배포하기")]),s._v(" "),t("p",[s._v("이 방법에서는 Kubernetes 환경에서 Helm Chart를 이용하여 배포하는 과정에 대해서 다룹니다.\n실제로 Production에서 사용하기 위해 배포할 때는 조금 더 섬세한 설정을 해줘야 하지만, 여기서는 최대한 간단히 배포하는 과정을 중심으로 알아봅시다.")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("이 글은 독자가 Kubernetes와 Helm에 대한 기본 지식이 있다고 가정합니다.\nKubernetes와 Helm에 대해서 처음 들어보신 분은 아래 글들을 읽어보시기를 추천드립니다.")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://subicura.com/2019/05/19/kubernetes-basic-1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("쿠버네티스 시작하기 - Kubernetes란 무엇인가?"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://spoqa.github.io/2020/03/30/k8s-with-helm-chart.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("스포카에서 Helm을 도입 하는 이야기"),t("OutboundLink")],1)])])]),s._v(" "),t("h2",{attrs:{id:"사전-준비"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#사전-준비"}},[s._v("#")]),s._v(" 사전 준비")]),s._v(" "),t("p",[s._v("우리는 Kubernetes 환경에서 배포할 것이기 떄문에 Kubernetes Cluster가 필요합니다.\n실제 회사에서는 AWS의 EKS나, GCP의 GKE 등 별도의 클러스터가 생성되어 있어야 하지만, 여기서는 로컬에서 간단히 실습할 수 있도록 준비해봅시다.")]),s._v(" "),t("h3",{attrs:{id:"kind-설치"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kind-설치"}},[s._v("#")]),s._v(" Kind 설치")]),s._v(" "),t("p",[s._v("Docker만 설치되어 있다면 "),t("a",{attrs:{href:"https://kind.sigs.k8s.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("kind"),t("OutboundLink")],1),s._v("를 통해 로컬에서도 쿠버네티스 클러스터를 생성해볼 수 있습니다.\n다음처럼 kind를 설치해봅시다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kind 설치 (Mac OS 기준)")]),s._v("\n$ brew "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" kind\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Linux나 Windows 혹은 Mac에서 brew가 아닌 다른 방법으로 설치하는 방법은 "),t("a",{attrs:{href:"https://github.com/kubernetes-sigs/kind#installation-and-usage",target:"_blank",rel:"noopener noreferrer"}},[s._v("공식 문서"),t("OutboundLink")],1),s._v("를 확인해주세요.")])]),s._v(" "),t("h3",{attrs:{id:"클러스터-생성"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#클러스터-생성"}},[s._v("#")]),s._v(" 클러스터 생성")]),s._v(" "),t("p",[s._v("다음처럼 Kubernetes Cluster를 생성합니다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kind create cluster --name my-kube-cluster\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("다음처럼 잘 생성되었는지 확인할 수 있습니다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl get svc\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nkubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   2m1s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"배포-구조"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#배포-구조"}},[s._v("#")]),s._v(" 배포 구조")]),s._v(" "),t("p",[s._v("TBD")]),s._v(" "),t("h2",{attrs:{id:"helm-chart-다운받기"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-chart-다운받기"}},[s._v("#")]),s._v(" Helm Chart 다운받기")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" apache-airflow https://airflow.apache.org\n$ helm repo update\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ helm search repo airflow\nNAME                  \tCHART VERSION\tAPP VERSION\tDESCRIPTION\napache-airflow/airflow\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(".0        \t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(".3      \tThe official Helm chart to deploy Apache Airflo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" chart\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" chart\n$ helm pull apache-airflow/airflow --version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(".0 --untar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\nairflow\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" airflow\n$ ll\n\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".6K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 CHANGELOG.txt\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   225B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 Chart.lock\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".4K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 Chart.yaml\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   568B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 INSTALL\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff    11K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 LICENSE\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   240B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 NOTICE\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".8K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 README.md\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".2K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 UPDATING.rst\ndrwxr-xr-x   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" heumsi  staff    96B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 charts\ndrwxr-xr-x   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" heumsi  staff   192B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 dockerfiles\ndrwxr-xr-x   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" heumsi  staff    96B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 files\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" heumsi  staff   704B Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 templates\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   344K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 values.schema.json\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff    44K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03 values.yaml\n-rw-r--r--   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" heumsi  staff   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".7K Feb "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":27 values_schema.schema.json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"values-yaml-수정하기"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#values-yaml-수정하기"}},[s._v("#")]),s._v(" "),t("code",[s._v("values.yaml")]),s._v(" 수정하기")]),s._v(" "),t("h3",{attrs:{id:"dags"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dags"}},[s._v("#")]),s._v(" DAGs")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gitSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    enabled: true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    repo: https://github.com/apache/airflow.git")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/heumsi/apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("airflow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tutorials"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("for"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("beginner\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    branch: v2-2-stable")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" main\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    subPath: "tests/dags"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" examples/dags\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Kubernetes에서 Airflow의 DAG Directory를 관리하는 방법은 다양합니다. 자세한 내용은 "),t("a",{attrs:{href:"https://airflow.apache.org/docs/helm-chart/stable/manage-dags-files.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("공식 문서"),t("OutboundLink")],1),s._v("를 확인해보세요.")])]),s._v(" "),t("h3",{attrs:{id:"executor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#executor"}},[s._v("#")]),s._v(" Executor")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#executor: "CeleryExecutor"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("executor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"KubernetesExecutor"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"logging"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[s._v("#")]),s._v(" Logging")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("logs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistence")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable persistent volume for storing logs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    enabled: true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),t("p",[t("code",[s._v("logs.persistence.enabled")]),s._v(" 의 값을 False로 준 이유는 대부분의 Kubernetes Cluster에서 "),t("code",[s._v("ReadWriteMany")]),s._v(" 형태의 PVC를 기본적으로 제공해주지 않기 때문입니다.\nKubernetes에서는 로그는 언제든 유실되므로, Remote Logging을 통해 로그를 따로 수집하는게 일반적입니다.")]),s._v(" "),t("p",[s._v("Remote Logging을 사용하는 부분은 이 글에서 다루지 않았습니다. (따라서 이대로 배포하면 Task Instance의 로그를 볼 수 없습니다.)\n이는 실제로 어떤 클라우드 벤더를 쓰느냐에 따라 조금씩 달라지는데, 이에 대한 내용은 추후에 다루겠습니다.")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("Kubernetes에서 Airflow의 로그를 관리하는 방법은 다양합니다. 자세한 내용은 "),t("a",{attrs:{href:"https://airflow.apache.org/docs/helm-chart/stable/manage-logs.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("공식 문서"),t("OutboundLink")],1),s._v("를 확인해보세요.")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("실제로 Production에서의 사용을 위한 배포에서는 다음처럼 "),t("code",[s._v("postgresql.enabled")]),s._v(" 를 false로 설정하고 클러스터 외부의 Database를 사용하기를 권장드립니다.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("postgresql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  enabled: true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("외부 Database 연결은 다음처럼 "),t("code",[s._v("airflow-database")]),s._v(" Secret에 "),t("code",[s._v("connection")]),s._v(" 키의 값으로 "),t("code",[s._v("sql_alchemy_conn")]),s._v(" 값을 주시면 됩니다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl create secret generic airflow-database --from-literal"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("connection"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("postgresql+psycopg2://airflow:1234@airflow-database:5432/airflow\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("h2",{attrs:{id:"helm-chart-배포"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-chart-배포"}},[s._v("#")]),s._v(" Helm Chart 배포")]),s._v(" "),t("h3",{attrs:{id:"namespace-생성"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#namespace-생성"}},[s._v("#")]),s._v(" Namespace 생성")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl create namespace airflow\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"chart-배포"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-배포"}},[s._v("#")]),s._v(" Chart 배포")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" airflow "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" --namespace airflow\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("다음처럼 잘 배포되었는지 확인할 수 있습니다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" --namespace airflow\n\nNAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION\nairflow   airflow       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-02-20 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":19:54.859207 +0900 KST    deployed        airflow-1.4.0   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(".3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl get all --namespace airflow\n\nNAME                                     READY   STATUS    RESTARTS   AGE\npod/airflow-postgresql-0                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m7s\npod/airflow-scheduler-6bc8cd6457-l85nr   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/3     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m7s\npod/airflow-statsd-7586f9998-q626g       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m7s\npod/airflow-triggerer-bfcbc47bf-ctdgg    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m7s\npod/airflow-webserver-7565fcf69d-vsx4q   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m7s\n\nNAME                                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             AGE\nservice/airflow-postgresql            ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".181.84    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("/TCP            2m7s\nservice/airflow-postgresql-headless   ClusterIP   None            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("/TCP            2m7s\nservice/airflow-statsd                ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".29.57     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9125")]),s._v("/UDP,9102/TCP   2m7s\nservice/airflow-webserver             ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".106.140   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP            2m7s\n\nNAME                                READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/airflow-scheduler   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           2m7s\ndeployment.apps/airflow-statsd      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           2m7s\ndeployment.apps/airflow-triggerer   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           2m7s\ndeployment.apps/airflow-webserver   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           2m7s\n\nNAME                                           DESIRED   CURRENT   READY   AGE\nreplicaset.apps/airflow-scheduler-6bc8cd6457   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       2m7s\nreplicaset.apps/airflow-statsd-7586f9998       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       2m7s\nreplicaset.apps/airflow-triggerer-bfcbc47bf    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       2m7s\nreplicaset.apps/airflow-webserver-7565fcf69d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       2m7s\n\nNAME                                  READY   AGE\nstatefulset.apps/airflow-postgresql   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     2m7s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h2",{attrs:{id:"webserver-접속"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webserver-접속"}},[s._v("#")]),s._v(" Webserver 접속")]),s._v(" "),t("p",[s._v("다음처럼 Webserver Service에 포트 포워딩하여 접근할 수 있습니다.")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ kubectl port-forward svc/airflow-webserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" -n airflow\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:e(560),alt:"img.png"}})]),s._v(" "),t("p",[s._v("초기 유저 이름은 "),t("code",[s._v("admin")]),s._v(", 비밀번호는 "),t("code",[s._v("admin")]),s._v(" 입니다. (이 정보는 "),t("code",[s._v("helm install")]),s._v(" 후 나오는 안내 문서에서 등장합니다.)")]),s._v(" "),t("p",[t("img",{attrs:{src:e(561),alt:"img_1.png"}})]),s._v(" "),t("h2",{attrs:{id:"함께-더-보면-좋을-내용"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#함께-더-보면-좋을-내용"}},[s._v("#")]),s._v(" 함께 더 보면 좋을 내용")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://airflow.apache.org/docs/helm-chart/stable/parameters-ref.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Values.yaml")]),s._v("에 있는 Parameter 설명"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://airflow.apache.org/docs/helm-chart/stable/production-guide.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("운영 배포를 위한 가이드"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);